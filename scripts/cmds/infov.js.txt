const axios = require('axios');
const fs = require('fs');
const path = require('path');
const moment = require('moment-timezone');

module.exports = {
  config: {
    name: "info",
    version: "2.0.0",
    author: "Priyanshi Kaur",
    countDown: 5,
    role: 0,
    shortDescription: {
      en: "Display bot owner information"
    },
    longDescription: {
      en: "Display detailed information about the bot owner,"
    },
    category: "info",
    guide: {
      en: "{prefix}info"
    }
  },

  onStart: async function ({ api, event }) {
    api.setMessageReaction("â³", event.messageID, (err) => {}, true);

    const ownerInfo = {
      botName: "YourBotName",
      ownerName: "YourName",
      age: "YourAge",
      location: "YourLocation",
      facebook: "https://www.facebook.com/PriyanshiKaurJi",
      telegram: "@priyanshikaurji",
      discord: "https://discord.gg/wBYsueQU"
    };

    try {
      // Get current time in Asia/Kolkata timezone
      const currentTime = moment().tz("Asia/Kolkata").format("MMMM Do YYYY, h:mm:ss A");

      // Get random fun fact
      const factResponse = await axios.get('https://api.api-ninjas.com/v1/facts?limit=1', {
        headers: { 'X-Api-Key': 'mz2frvHwqBCS3dTjkjM2wA==RaABY2HqVA2A58w0' } // Thay tháº¿ báº±ng API key há»£p lá»‡
      });
      const funFact = factResponse.data[0].fact;

      // Download image
      const imageUrl = 'https://i.imgur.com/JRPaKw7.png';
      const imagePath = path.join(__dirname, 'temp', 'owner_image.png');

      // Kiá»ƒm tra thÆ° má»¥c 'temp', náº¿u chÆ°a tá»“n táº¡i thÃ¬ táº¡o má»›i
      if (!fs.existsSync(path.join(__dirname, 'temp'))) {
        fs.mkdirSync(path.join(__dirname, 'temp'));
      }

      // Táº£i áº£nh vá»
      const imageResponse = await axios.get(imageUrl, { responseType: 'arraybuffer' });
      fs.writeFileSync(imagePath, Buffer.from(imageResponse.data));

      // Chuáº©n bá»‹ ná»™i dung tin nháº¯n
      const message = `
ðŸ¤– Bot Name: ${ownerInfo.botName}
ðŸ‘¤ Owner Name: ${ownerInfo.ownerName}
ðŸŽ‚ Age: ${ownerInfo.age}
ðŸ“ Location: ${ownerInfo.location}
ðŸ“± Social Media:
   ðŸ“˜ Facebook: ${ownerInfo.facebook}
   ðŸ“ž Telegram: ${ownerInfo.telegram}
   ðŸŽ® Discord: ${ownerInfo.discord}

ðŸ•°ï¸ Current Time (Asia/Kolkata): ${currentTime}

ðŸŽ¨ Fun Fact: ${funFact}

Thanks for using our bot! ðŸ˜Š
      `.trim();

      // Gá»­i tin nháº¯n vá»›i áº£nh Ä‘Ã­nh kÃ¨m
      api.sendMessage(
        { body: message, attachment: fs.createReadStream(imagePath) },
        event.threadID,
        (err) => {
          if (err) {
            console.error('Error sending message:', err);
            api.setMessageReaction("âŒ", event.messageID, (err) => {}, true);
          } else {
            api.setMessageReaction("âœ…", event.messageID, (err) => {}, true);
          }

          // XÃ³a tá»‡p áº£nh táº¡m thá»i sau khi gá»­i
          fs.unlinkSync(imagePath);
        }
      );

    } catch (error) {
      console.error('ERROR:', error.response ? error.response.data : error.message);
      api.setMessageReaction("âŒ", event.messageID, (err) => {}, true);
      api.sendMessage("An error occurred while fetching owner information. Please try again later.", event.threadID);
    }
  }
};